# Расчёт витрин оборотов и остатков

## Описание

Реализация расчёта витрин данных слоя DM на основе детального слоя DS:
- витрина оборотов по лицевым счетам;
- витрина остатков по лицевым счетам.

Расчёт выполнен с использованием хранимых процедур PostgreSQL с возможностью повторного запуска и логированием.

## Структура проекта
- `calculate_january.py` - запуск расчёта витрин за январь 2018 года
- `clear_dm.py` - очистка витрин DM перед перерасчётом
- `create_procedures.py` - создание процедур расчёта витрин
- `create_dm_procedures.py` - создание таблиц и процедур слоя DM
- `config.py` - конфигурация подключения к БД
- `video_link1_2.txt` - ссылка на демонстрационное видео

## Запуск
1. Создание таблиц и процедур:
```bash
python create_dm_procedures.py
python create_procedures.py
```

2. Очистка витрин (при необходимости)
```bash
python clear_dm.py
```

3. Расчёт витрин за январь 2018 года
```bash
python calculate_january.py
```

## Реализованные витрины
### Витрина оборотов
**Таблица:** `DM.DM_ACCOUNT_TURNOVER_F`  
**Процедура:** `ds.fill_account_turnover_f(i_OnDate DATE)`

В витрине рассчитываются:
- дебетовые и кредитовые обороты;
- суммы в валюте счета и в рублях;
- данные формируются только по счетам с операциями за дату расчёта.

### Витрина остатков
**Таблица:** `DM.DM_ACCOUNT_BALANCE_F`  
**Процедура:** `ds.fill_account_balance_f(i_OnDate DATE)`

Алгоритм расчёта учитывает:
- тип счета (активный / пассивный);
- остаток предыдущего дня;
- обороты текущего дня;
- дни без оборотов (остаток всё равно рассчитывается).

## Особенности

В процедурах реализовано логирование:
- наименования витрины;
- даты расчёта;
- времени начала и окончания выполнения.

Перед каждым запуском:
- данные за дату расчёта удаляются, что позволяет безопасно выполнять перерасчёт.

### Демонстрация работы

Ссылка на демонстрационное видео находится в файле video_link1_2.txt.

В видео показано:
- запуск расчёта витрин;
- поэтапное появление данных за разные дни января 2018 года;
- процесс логирования внутри процедур.
